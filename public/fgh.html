<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Community</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { background: #0088cc; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; }
        .hidden { display: none; }
        .post { border: 1px solid #eee; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .admin-badge { background: #ff4757; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ü§ñ Telegram Community</h1>
            <div id="authSection">
                <button onclick="login(123456)">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                <button onclick="login(8036875641)">–í–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω</button>
            </div>
            <div id="userSection" class="hidden">
                <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                <div id="userInfo"></div>
                <button onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div id="adminSection" class="card hidden">
            <h3>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
            <input type="text" id="postTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞">
            <textarea id="postContent" placeholder="–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞" rows="4"></textarea>
            <button onclick="createPost()">üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>

        <div class="card">
            <h3>üì∞ –ù–æ–≤–æ—Å—Ç–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h3>
            <div id="postsContainer">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <script>
        let currentUser = null;
        const ADMIN_ID = 8036875641;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤
        async function loadPosts() {
            try {
                const response = await fetch('/api/posts');
                const posts = await response.json();
                displayPosts(posts);
            } catch (error) {
                document.getElementById('postsContainer').innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π';
            }
        }

        function displayPosts(posts) {
            const container = document.getElementById('postsContainer');
            if (posts.length === 0) {
                container.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π</p>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="post">
                    <h4>${post.title}</h4>
                    <p>${post.content}</p>
                    <small>${new Date(post.created_at).toLocaleDateString('ru-RU')}</small>
                    ${currentUser && currentUser.id === ADMIN_ID ? 
                        `<button onclick="deletePost(${post.id})" style="background: #ff4757;">–£–¥–∞–ª–∏—Ç—å</button>` : ''}
                </div>
            `).join('');
        }

        async function login(userId) {
            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegram_id: userId,
                        first_name: userId === ADMIN_ID ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                        last_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
                        username: userId === ADMIN_ID ? 'admin' : 'user'
                    })
                });
                
                currentUser = await response.json();
                showUserInterface();
                loadPosts();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
            }
        }

        function showUserInterface() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('userSection').classList.remove('hidden');
            
            document.getElementById('userInfo').innerHTML = `
                <p><strong>ID:</strong> ${currentUser.id}</p>
                <p><strong>–ò–º—è:</strong> ${currentUser.first_name} ${currentUser.last_name}</p>
                <p><strong>–†–æ–ª—å:</strong> ${currentUser.id === ADMIN_ID ? '<span class="admin-badge">–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†</span>' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</p>
            `;

            if (currentUser.id === ADMIN_ID) {
                document.getElementById('adminSection').classList.remove('hidden');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('userSection').classList.add('hidden');
            document.getElementById('adminSection').classList.add('hidden');
        }

        async function createPost() {
            if (!currentUser || currentUser.id !== ADMIN_ID) return;

            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;

            if (!title || !content) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            try {
                await fetch('/api/posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title,
                        content,
                        author_id: currentUser.id
                    })
                });

                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
                loadPosts();
                alert('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏');
            }
        }

        async function deletePost(postId) {
            if (!currentUser || currentUser.id !== ADMIN_ID) return;

            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) return;

            try {
                await fetch(`/api/posts/${postId}`, { method: 'DELETE' });
                loadPosts();
                alert('–ü–æ—Å—Ç —É–¥–∞–ª–µ–Ω!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadPosts();
    </script>
</body>
</html>